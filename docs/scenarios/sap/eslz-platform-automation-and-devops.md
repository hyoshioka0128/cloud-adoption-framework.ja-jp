---
title: SAP on Azure 用のエンタープライズ規模のプラットフォームの自動化と DevOps
description: SAP システム、環境、ランドスケープ間の依存関係を理解し、アプリケーションのデプロイと管理を自動化します。
author: JefferyMitchell
ms.author: brblanch
ms.date: 02/11/2021
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.custom: think-tank, e2e-sap
ms.openlocfilehash: 2f87c003a33746c285831d91267d0a7b430efacc
ms.sourcegitcommit: 5716a8165934bd69d02d9d3641785039196aee3a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/29/2021
ms.locfileid: "105734010"
---
<!-- docutune:casing Snow -->

# <a name="sap-enterprise-scale-platform-automation-and-devops"></a>エンタープライズ規模の SAP プラットフォームの自動化と DevOps

クラウド導入フレームワークに含まれるすべての原則は、SAP Automation に適用されます。このセクションでは、SAP Automation への対処を開始する方法について説明します。

自動化アプローチを決定する際に重要なのは、SAP アプリケーション ランドスケープを調べて主要なコンポーネントを特定し、それに基づいて自動化戦略を定義することです。

SAP アプリケーションはミッションクリティカルであり、世界中の企業のテクノロジのバックボーンを形成します。 企業にとって SAP システムは重要であるため、ソリューションが認定、サポート、および正常に実装されていることを確認するためのガイドラインが、SAP および Microsoft Azure によって提供されます。 SAP のデプロイとシステム構成は複雑なタスクです。 Azure クラウドの機敏性を活用することで、運用効率がよく、制御されており、コードにより柔軟に対応できるインフラストラクチャをデプロイできるよう SAP デプロイ活動の自動化を模索します。

Microsoft の SAP Automation リポジトリは、Azure SAP のお客様が既存の DevOps プラクティスにスクリプトを組み込むことができるように設計されています。また、リポジトリ複製から直接、そのままコードを使用することもできます。

## <a name="sap-architecture"></a>SAP アーキテクチャ:

SAP アプリケーション資産は、システム、ワークロードゾーン、ランドスケープで構成されています。

### <a name="system"></a>システム

SAP システムは、アプリケーションが実行する必要のあるリソース (仮想マシン (VM)、ディスク、ロードバランサー、近接配置グループ、可用性セット、サブネット、ネットワークセキュリティグループなど) を備えた SAP アプリケーションのインスタンスです。 アプリケーションは、一意な 3 文字識別子 SID によって識別されます。

ライフサイクルを目的として、各システムを別の Azure リソース グループにデプロイする必要があります。

### <a name="workload-zone"></a>ワークロード ゾーン

ワークロード ゾーンはデプロイ環境とも呼ばれ、SAP アプリケーションを非運用用や運用用などの環境に分割したり、開発、品質保証、運用などのレベルにさらに分割したりすることができます。 デプロイ環境では、仮想ネットワークやキーコンテナーなどの共有リソースをワークロード ゾーン内のすべてのシステムに提供します。

### <a name="landscape"></a>横

ランドスケープとは、SAP アプリケーションのさまざまな環境にあるシステムの集合です。 この図の例は、SAP ERP Central Component (ECC)、SAP カスタマー リレーションシップ マネジメント (CRM)、および SAP Business Warehouse (BW) という 3 つの SAP ランドスケープを示しています。

次の図は、SAP システム、ワークロード ゾーン、およびランドスケープ間の依存関係を示しています。 以下の図の例は、お客様には SAP ERP Central Component (ECC)、SAP カスタマー リレーションシップ マネジメント (CRM)、および SAP Business Warehouse (BW) という 3 つのランドスケープがあることを示しています。 各ランドスケープには、サンドボックス、開発、品質保証、および運用の 4 つのワークロード ゾーンがあります。 各ワークロード ゾーンには、1 つまたは複数のシステムを含めることができます。

![SAP アプリケーション資産](./media/SAP_estate.png)
*図 1.SAP アプリケーション資産。*

### <a name="additional-components"></a>追加コンポーネント

自動化ソリューションに必要な SAP コンポーネントに加えて、次のものが必要になります。

- デプロイ活動を実行できる実行環境。
- インストール メディア用の永続ストレージ。 Terraform が使用されている場合は、 Terraform 状態ファイル用のストレージ。

**設計上の推奨事項:**

- アプリケーションの構成とインストールを有効にするために、ターゲット仮想ネットワークへのネットワーク接続がある仮想マシンを使用します。
- 状態ファイルの管理には Azure Storage アカウントを使用し、SAP インストール メディアの場合はインストール ソースとして使用します。

## <a name="preparation-activities"></a>準備アクティビティ

### <a name="deciding-on-a-devops-strategy"></a>DevOps 戦略の決定

SAP デプロイの自動化は、インフラストラクチャのデプロイから始まり、その後にオペレーティング システムの構成とアプリケーションのインストールが行われるワークフローとして実装されます。

**設計上の考慮事項:**

- 自動化のスコープを定義する
  - インフラストラクチャ
  - オペレーティング システムの構成
  - アプリケーションのインストール
  - 進行中の操作 (実行状態の操作)
- パラメーターファイルを格納するための戦略を定義する

**設計上の推奨事項:**

- すべてのパラメーター ファイルをソース管理リポジトリに格納する
- ファイルの破損を防ぐために、状態ファイルとパラメーター ファイルをバックアップします。 たとえば、Terraform の状態ファイルは、読み取りアクセス geo 冗長ストレージ (RA GRS) ベースのホットストレージ アカウントに格納できます。

### <a name="region-planning"></a>領域の計画策定

SAP デプロイ自動化フレームワークでは、複数の Azure リージョンでのデプロイがサポートされています。 各リージョンは次をホストします。

- インフラストラクチャのデプロイ
- 状態および SAP インストール メディア用の SAP ライブラリ
- 1～n 個のワークロードゾーン
- ワークロード ゾーンにデプロイされた 1 ~ n 個の SAP システム。

次の図は、2 つの Azure リージョンのデプロイ戦略を示しています。

![SAP DevOps 戦略。](./media/SAP_DevOps_strategy.png)

*図 2: リージョン間での SAP Automation*

**設計上の考慮事項:**

- どの Azure リージョンがスコープ内にありますか?
- ディザスター リカバリーの考慮事項

### <a name="workload-zone-planning"></a>ワークロード ゾーンの計画策定

ワークロードゾーンは、ワークロードの仮想ネットワークと、そのワークロード内のシステムで使用される資格情報のセットと、システムのデプロイに使用されるサービス プリンシパルを組み合わせたものです。 ワークロード ゾーンは、Azure 仮想ネットワークに依存しているため、リージョンになっています。 オートメーションの名前付け規則では、それぞれが独自の仮想ネットワークを持つ複数の Azure リージョン内のワークロード ゾーンがサポートされます。

ワークロード ゾーンはデプロイ環境とも呼ばれ、SAP アプリケーションを非運用用や運用用などの環境に分割したり、開発、品質保証、運用などのレベルにさらに分割したりすることができます。 デプロイ環境では、仮想ネットワークやキーコンテナーなどの共有リソースをワークロード ゾーン内のすべてのシステムに提供します。

ワークロード ゾーンの一般的なパターンは次のとおりです。

#### <a name="production-and-non-production"></a>運用と非運用

このモデルでは、SAP 環境は、運用環境と非運用環境の 2 つのゾーンに分割されます。

#### <a name="sandbox-development-quality-assurance-production"></a>サンドボックス、開発、品質保証、運用

このモデルでは、SAP 環境は、サンドボックス、開発、品質保証、運用の 4 つのゾーンに分割されます。

**設計上の考慮事項:**

- ワークロード ゾーンはいくつ必要ですか?
- サブスクリプション デザイン
  - サブスクリプションに複数のワークロード ゾーンが含まれているか
- ワークロードはどのリージョンにデプロイされていますか?
- 送信インターネット接続性
- オンプレミス ネットワークへのネットワーク接続
- デプロイは、未開発デプロイ (ワークロードのための Azure インフラストラクチャが存在しない) か、(ワークロード ゾーンをサポートするすべての成果物の一部またはすべてが既に存在している) のいずれかの配置になりますか?
- デプロイ資格情報。各ワークロード ゾーンには一意のデプロイ資格情報が必要ですか?

**設計上の推奨事項:**

- 送信インターネット接続性は、ネットワーク チームから提供される必要あり
- オンプレミス ネットワークへのネットワーク接続は、ネットワークチームが提供する必要あり
- ワークロード ゾーンごとに一意のデプロイ資格情報を使用します。 **注** ワークロード ゾーンが複数のリージョンに存在する場合は、同じデプロイ資格情報を使用する必要があります。
- ネットワーク計画を簡略化するために、ワークロード ゾーンの数を最小限にしてみてください

### <a name="sap-application-planning"></a>SAP アプリケーションの計画策定

SAP システムは実際の SAP アプリケーションであり、SAP アプリケーションをホストするために必要なすべての Azure Artifacts が含まれています。 開始、計画、デプロイ要因の詳細については、[SAP on Azure](/azure/virtual-machines/workloads/sap/get-started) を参照してください。

**設計上の考慮事項:**

- どのデータベース バックエンドを使用しますか?
- データベース サーバーの数は?
- 高可用性は必要ですか?
- アプリケーション サーバーの数は?
- Web ディスパッチャーの数は (存在する場合) ?
- 中央サービス インスタンスの数は?
- 仮想マシンのサイズは?
- Azure Marketplace イメージとカスタムビルド イメージのどちらを使用するかを決定します。 カスタムビルドのイメージには、お客様固有の OS 構成、セキュリティの強化、コンプライアンスツールなど、いくつかの利点があります。 また、カスタムビルド イメージを使用すると、イメージ ライフサイクル管理が合理化される可能性があります。
- デプロイは、グリーンフィールド デプロイ (作成したサブネット用の Azure インフラストラクチャが存在しない) か、ブラウンフィールドのデプロイ (サブネット用の成果物の一部またはすべてが既に存在している) のいずれかの配置になりますか?
- IP 割り当て戦略 (Azure またはお客様提供)
- Azure リソースの名前付け規則
- 資格情報管理要件を定義します。ワークロード ゾーン内のすべてのシステムが仮想マシンへのアクセスに同じ資格情報を使用できますか?

**設計上の推奨事項:**

- 既定の SAP Automation 標準の名前付け規則を使用します。 SAP Automation は、一連の名前付け規則ガイドライン[名前付け規則](https://github.com/Azure/sap-hana/blob/master/documentation/SAP_Automation_on_Azure/Software_Documentation/standards-naming.md)を発行します。
- ワークロード ゾーンにデプロイされているシステムごとに、同じ資格情報のセットを使用します。 Azure Key Vault は、キー管理とキーの保存に推奨されるソリューションです。

## <a name="the-sap-deployment-automation-framework"></a>SAP デプロイ自動化フレームワーク

SAP デプロイ自動化フレームワークには、Terraform テンプレートと、SAP on Azure を実行する環境を構築および構成するために使用できる Ansible プレイブックの両方が用意されています。 成果物は、 [sap-hana](https://github.com/Azure/sap-hana) リポジトリでホストされます。 SAP on Azure のデプロイ スクリプトはオープンソースであり、Azure でサポートされています (カスタマイズされていないコード)。

### <a name="automation-capabilities"></a>自動化の機能

#### <a name="supported-platforms"></a>サポートされているプラットフォーム

SAP デプロイの自動化では、Linux と Windows の両方でデプロイがサポートされる

#### <a name="supported-topologies"></a>サポートされているトポロジ

SAP デプロイの自動化を使用する既定のデプロイ モデルは、データベース層とアプリケーション層からなる分散モデルです。 アプリケーション層は、アプリケーション サーバー、中央サービスサーバー、Web ディスパッチャという 3 つのレベルに分割できます。

アプリケーション層を使用せずに構成を指定することによって、オートメーションをスタンドアロン サーバーにデプロイすることもできます。

#### <a name="included-capabilities"></a>含まれる機能

SAP デプロイ自動化フレームワーク機能のマトリックス

| 機能 | Included | メモ |
|:-|:-|:-|
| Accelerated Networking | Y | 高速ネットワークが VM で有効化 |
| アプリケーション セキュリティ グループ | N | ロードマップ上 |
| アンカー VM | Y | 可用性ゾーン内の近接配置グループを固定するために使用される仮想マシン |
| アプリケーションの構成 | N | Ansibleベースの構成がまもなくリリースされます。 |
| アプリケーションのインストール | N | Ansibleベースのインストールがまもなくリリースされます。 |
| 認証 | Y | 認証では、SSH ベースの認証とユーザー名/パスワードベースの認証の両方がサポートされます。 |
| 可用性ゾーン | Y | オートメーションでは、仮想マシンのゾーンまたは複数の可用性ゾーンをデプロイできます。 |
| NFS 用 Azure Files | N | ロードマップ上 |
| Azure Firewall | Y | オートメーションでは、配置機能ネットワークに Azure Firewall をデプロイできます。 |
| Azure Load Balancer | Y | オートメーションでは、標準の Azure ロードバランサーを使用します。 |
| Azure NetApp Files | N | ロードマップ上 |
| ブート診断ストレージ アカウント | Y | ブート診断ストレージ アカウントは、ワークロード ゾーン内のすべてのシステム間で共有 |
| Azure キー コンテナー | Y | 新しい、または既存の Azure キー コンテナー |
| 顧客のイメージ | Y | カスタム イメージをリージョンにレプリケートする必要があります |
| お客様マネージド ディスクの暗号化キー | Y | キーは事前に作成し、 Azure Key Vault に格納する必要があります。 |
| デプロイ環境 | Y | SAP ネットワークとピアリングされたネットワーク内の仮想マシン |
| ディスクのサイズ変更 | Y | 指定された既定のディスク サイズ設定を構成できます |
| IP アドレス指定 | Y | お客様が指定した IP アドレスと Azure の両方が提供されています |
| 命名規則 | Y | 既定の名前付け規則 (カスタマイズ可能) |
| ネットワーク セキュリティ グループ | Y | 新しい、または既存のネットワーク セキュリティ グループ |
| オペレーティング システムの構成 | N | Ansibleベースの構成がまもなくリリースされます。 |
| 近接通信配置グループ | Y | 新しい、または既存の近接配置グループ |
| リソース グループ | Y | 新しい、または既存のリソース グループ |
| サブネット | Y | 新しい、または既存のサブネット |
| SAP インストール メディア用ストレージ | Y | 新しい、または既存のストレージ アカウント |
| Terraform 状態用のストレージ | Y | 新しい、または既存のストレージ アカウント |
| 仮想マシン SKU | Y | すべての仮想マシンの SKU を構成できます。 |
| 仮想ネットワーク | Y | 新規または既存の仮想ネットワーク |
| 監視ストレージ アカウント | Y | 監視ストレージ アカウントは、ワークロード ゾーン内のすべてのシステム間で共有されます。 Windows の高可用性シナリオに使用 |

### <a name="planning-for-the-parameter-files"></a>パラメーター ファイルの計画

SAP デプロイの自動化では、json パラメーター ファイルを利用して、さまざまな成果物に対して異なるパラメーター ファイルを使用し Azure 環境を構成します。

開発環境では、 `SAP HANA` リポジトリと顧客リポジトリの両方を同じルート フォルダーに複製する必要があります。

事前に定義されたフォルダー構造にパラメーター ファイルを用意すると、自動デプロイ操作が簡略化されます。

**設計上の推奨事項:**

すべてのパラメーター ファイルは、ソース管理環境に格納されている必要があります。
